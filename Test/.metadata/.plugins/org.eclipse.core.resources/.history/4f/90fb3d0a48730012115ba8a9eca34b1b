import java.io.File;
import java.io.FileInputStream;
import java.io.RandomAccessFile;
import java.util.Arrays;
import java.util.StringTokenizer;


public class FileCombination {
	
	String srcDirectory = null;
	String[] separatedFiles;
	String[][] separatedFilesAndSize;
	int fileNum=0;
	String fileRealName="";
	
	
	public FileCombination(){};
	
	
	private String getRealName(String sFileName){
		StringTokenizer st = new StringTokenizer(sFileName,".");
		return st.nextToken()+"."+st.nextToken();
	}
	
	private long getFileSize(String fileName){
		fileName = this.srcDirectory + fileName;
		return (new File(fileName).length());	
	}
	
	private void getFileAttribute(String directory)
	{
		File file = new File(directory);
		this.separatedFiles = new String[file.list().length];
		this.separatedFiles = file.list();
		this.separatedFilesAndSize = new String[separatedFiles.length][2];
		Arrays.sort(separatedFiles);
		this.fileNum = separatedFiles.length;
		
		for(int i=0; i<this.fileNum; i++){
			separatedFilesAndSize[i][0] = separatedFiles[i];
			separatedFilesAndSize[i][0] = String.valueOf(getFileSize(separatedFiles[i]));
		}
		
		this.fileRealName = getRealName(separatedFiles[this.fileNum-1]);
		
	}
	
	public boolean combineFile()
	{
		RandomAccessFile raf = null;
		long alreadyWrite = 0;
		FileInputStream fis = null;
		int len = 0;
		byte[] bt = new byte[1024];
		
		try{
			raf = new RandomAccessFile(srcDirectory+fileRealName, "rw");
			for(int i=0; i<fileNum;i++)
			{
				raf.seek(alreadyWrite);
				fis = new FileInputStream(srcDirectory+separatedFilesAndSize[i][0]);
				while((len = fis.read(bt))>0)
				{
					raf.write(bt,0,len);
				}
				fis.close();
				alreadyWrite = alreadyWrite + Long.parseLong(separatedFilesAndSize[i][1]);
				
				
			}
			
			raf.close();
		}catch(Exception ex){
			ex.printStackTrace();
			try{
				if(raf!=null)
					raf.close();
				if(fis!=null)
					fis.close();
			}
			catch(Exception e)
			{
				e.printStackTrace();
			}
			
			
		}
		return false;
	}
}
